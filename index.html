<html>

<head>

    <style>
        #main-image {
            display: block;
            margin-left: auto;
            margin-right: auto;
            margin-bottom: 10px;
        }
        .neighbour {
            height: 200px;
        }
    </style>

    <script typeof="text/javascript">
        var imageList = null;
        var imageListIndex = 0;
        var arachnePath = "http://bogusman02.dai-cloud.uni-koeln.de/data";

        function updateDisplayedImage() {

            var selectedFile = imageList[imageListIndex];

            var xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            xobj.open('GET', './output/' + selectedFile + '.neighbours.json', true); // Replace 'my_data' with the path to your file
            xobj.onreadystatechange = function () {

                if (xobj.readyState == 4 && xobj.status == "200") {
                    // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                    var json_data = JSON.parse(xobj.responseText)
                    var main_image_element = document.querySelector('#main-image');

                    setImage(json_data['file_name'], main_image_element);

                    for(var index in json_data['neighbours']){
                        var neighbour = json_data['neighbours'][index];
                        var neighbour_element = document.querySelector('#neighbour-' + index);

                        setImage(neighbour['file_name'], neighbour_element)
                    }
                }
            };
            xobj.send(null);
        }

        function setImage(image_name, element) {
            var xobj = new XMLHttpRequest();
            xobj.open('GET', arachnePath + '/search?q=' + image_name)
            xobj.onreadystatechange = function () {
                if (xobj.readyState == 4 && xobj.status == "200") {
                    var search_json = JSON.parse(xobj.responseText);

                    var imageUrl;

                    if(!search_json['entities']){
                        imageUrl = ''
                    }
                    else {
                        imageUrl = arachnePath +"/image/" + search_json['entities'][0]['entityId']
                    }

                    element.src = imageUrl;
                }
            };
            xobj.send(null);
        }

        function init() {

            var xobj = new XMLHttpRequest();
            xobj.overrideMimeType("application/json");
            xobj.open('GET', './output/images_list.json', true); // Replace 'my_data' with the path to your file
            xobj.onreadystatechange = function () {

                if (xobj.readyState === 4 && xobj.status == "200") {
                    // Required use of an anonymous callback as .open will NOT return a value but simply returns undefined in asynchronous mode
                    imageList = JSON.parse(xobj.responseText);
                    updateDisplayedImage()
                }
            };
            xobj.send(null);
        }

        function decreaseImageIndex(){
            imageListIndex -= 1;
            if(imageListIndex < 0)
                imageListIndex = 0;
            updateDisplayedImage()
        }

        function setRandomImage(){
            imageListIndex = Math.floor(Math.random()*imageList.length);
            updateDisplayedImage()
        }

        function increaseImageIndex(){
            imageListIndex += 1;
            if(imageListIndex >= imageList.length){
                imageListIndex = imageList.length - 1
            }
            updateDisplayedImage()
        }

        init()
    </script>

</head>

<body>

<div>
    <button onclick="decreaseImageIndex()">Previous</button>
    <button onclick="setRandomImage()">Random</button>
    <button onclick="increaseImageIndex()">Next</button>
</div>

<div>
    <img id="main-image" src="">
</div>

<div>

    <img class="neighbour" id="neighbour-0" src="">
    <img class="neighbour" id="neighbour-1" src="">
    <img class="neighbour" id="neighbour-2" src="">
    <img class="neighbour" id="neighbour-3" src="">
    <img class="neighbour" id="neighbour-4" src="">
    <img class="neighbour" id="neighbour-5" src="">
    <img class="neighbour" id="neighbour-6" src="">
    <img class="neighbour" id="neighbour-7" src="">
    <img class="neighbour" id="neighbour-8" src="">
    <img class="neighbour" id="neighbour-9" src="">
    <img class="neighbour" id="neighbour-10" src="">
    <img class="neighbour" id="neighbour-11" src="">
    <img class="neighbour" id="neighbour-12" src="">
    <img class="neighbour" id="neighbour-13" src="">
    <img class="neighbour" id="neighbour-14" src="">
    <img class="neighbour" id="neighbour-15" src="">
    <img class="neighbour" id="neighbour-16" src="">
    <img class="neighbour" id="neighbour-17" src="">
    <img class="neighbour" id="neighbour-18" src="">
    <img class="neighbour" id="neighbour-19" src="">
</div>

</body>

</html>